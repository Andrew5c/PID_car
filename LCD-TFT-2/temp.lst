C51 COMPILER V9.01   TEMP                                                                  07/03/2018 16:49:55 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TEMP
OBJECT MODULE PLACED IN temp.obj
COMPILER INVOKED BY: D:\keilC51\C51\BIN\C51.EXE USERS\temp.c BROWSE DEBUG OBJECTEXTEND PRINT(.\temp.lst) OBJECT(temp.obj
                    -)

line level    source

   1          #include "MAIN.H"
   2          
   3          //ÓÃÓÚ´æ·ÅÎÂ¶È
   4          struct temp{
   5          
   6                  char shi_wei;
   7                  char ge_wei;
   8                  char dian_yi;
   9                  char dian_er;
  10          
  11          }TEMP;
  12          
  13          
  14          /*******************************************************************************
  15          * º¯ÊýÃû         : Delay1ms
  16          * º¯Êý¹¦ÄÜ                 : ÑÓÊ±º¯Êý
  17          * ÊäÈë           : ÎÞ
  18          * Êä³ö           : ÎÞ
  19          *******************************************************************************/
  20          
  21          void Delay1ms(unsigned int y)
  22          {
  23   1              unsigned int x;
  24   1              for(y;y>0;y--)
  25   1                      for(x=110;x>0;x--);
  26   1      }
  27          /*******************************************************************************
  28          * º¯ÊýÃû         : Ds18b20Init
  29          * º¯Êý¹¦ÄÜ                 : ³õÊ¼»¯
  30          * ÊäÈë           : ÎÞ
  31          * Êä³ö           : ³õÊ¼»¯³É¹¦·µ»Ø1£¬Ê§°Ü·µ»Ø0
  32          *******************************************************************************/
  33          
  34          unsigned char Ds18b20Init()
  35          {
  36   1              unsigned int i;
  37   1              DSPORT=0;                        //½«×ÜÏßÀ­µÍ480us~960us
  38   1              i=70;   
  39   1              while(i--);//ÑÓÊ±642us
  40   1              DSPORT=1;                       //È»ºóÀ­¸ß×ÜÏß£¬Èç¹ûDS18B20×ö³ö·´Ó¦»á½«ÔÚ15us~60usºó×ÜÏßÀ­µÍ
  41   1              i=0;
  42   1              while(DSPORT)   //µÈ´ýDS18B20À­µÍ×ÜÏß
  43   1              {
  44   2                      i++;
  45   2                      if(i>5000)//µÈ´ý>5MS
  46   2                              return 0;//³õÊ¼»¯Ê§°Ü   
  47   2              }
  48   1              return 1;//³õÊ¼»¯³É¹¦
  49   1      }
  50          
  51          /*******************************************************************************
  52          * º¯ÊýÃû         : Ds18b20WriteByte
  53          * º¯Êý¹¦ÄÜ                 : Ïò18B20Ð´ÈëÒ»¸ö×Ö½Ú
  54          * ÊäÈë           : com
C51 COMPILER V9.01   TEMP                                                                  07/03/2018 16:49:55 PAGE 2   

  55          * Êä³ö           : ÎÞ
  56          *******************************************************************************/
  57          
  58          void Ds18b20WriteByte(unsigned char dat)
  59          {
  60   1              unsigned int i,j;
  61   1              for(j=0;j<8;j++)
  62   1              {
  63   2                      DSPORT=0;                       //Ã¿Ð´ÈëÒ»Î»Êý¾ÝÖ®Ç°ÏÈ°Ñ×ÜÏßÀ­µÍ1us
  64   2                      i++;
  65   2                      DSPORT=dat&0x01; //È»ºóÐ´ÈëÒ»¸öÊý¾Ý£¬´Ó×îµÍÎ»¿ªÊ¼
  66   2                      i=6;
  67   2                      while(i--); //ÑÓÊ±68us£¬³ÖÐøÊ±¼ä×îÉÙ60us
  68   2                      DSPORT=1;       //È»ºóÊÍ·Å×ÜÏß£¬ÖÁÉÙ1us¸ø×ÜÏß»Ö¸´Ê±¼ä²ÅÄÜ½Ó×ÅÐ´ÈëµÚ¶þ¸öÊýÖµ
  69   2                      dat>>=1;
  70   2              }
  71   1      }
  72          /*******************************************************************************
  73          * º¯ÊýÃû         : Ds18b20ReadByte
  74          * º¯Êý¹¦ÄÜ                 : ¶ÁÈ¡Ò»¸ö×Ö½Ú
  75          * ÊäÈë           : com
  76          * Êä³ö           : ÎÞ
  77          *******************************************************************************/
  78          
  79          
  80          unsigned char Ds18b20ReadByte()
  81          {
  82   1              unsigned char byte,bi;
  83   1              unsigned int i,j;       
  84   1              for(j=8;j>0;j--)
  85   1              {
  86   2                      DSPORT=0;//ÏÈ½«×ÜÏßÀ­µÍ1us
  87   2                      i++;
  88   2                      DSPORT=1;//È»ºóÊÍ·Å×ÜÏß
  89   2                      i++;
  90   2                      i++;//ÑÓÊ±6usµÈ´ýÊý¾ÝÎÈ¶¨
  91   2                      bi=DSPORT;       //¶ÁÈ¡Êý¾Ý£¬´Ó×îµÍÎ»¿ªÊ¼¶ÁÈ¡
  92   2                      /*½«byte×óÒÆÒ»Î»£¬È»ºóÓëÉÏÓÒÒÆ7Î»ºóµÄbi£¬×¢ÒâÒÆ¶¯Ö®ºóÒÆµôÄÇÎ»²¹0¡£*/
  93   2                      byte=(byte>>1)|(bi<<7);                                           
  94   2                      i=4;            //¶ÁÈ¡ÍêÖ®ºóµÈ´ý48usÔÙ½Ó×Å¶ÁÈ¡ÏÂÒ»¸öÊý
  95   2                      while(i--);
  96   2              }                               
  97   1              return byte;
  98   1      }
  99          /*******************************************************************************
 100          * º¯ÊýÃû         : Ds18b20ChangTemp
 101          * º¯Êý¹¦ÄÜ                 : ÈÃ18b20¿ªÊ¼×ª»»ÎÂ¶È
 102          * ÊäÈë           : com
 103          * Êä³ö           : ÎÞ
 104          *******************************************************************************/
 105          
 106          void  Ds18b20ChangTemp()
 107          {
 108   1              Ds18b20Init();
 109   1              Delay1ms(1);
 110   1              Ds18b20WriteByte(0xcc);         //Ìø¹ýROM²Ù×÷ÃüÁî                
 111   1              Ds18b20WriteByte(0x44);     //ÎÂ¶È×ª»»ÃüÁî
 112   1      //      Delay1ms(100);  //µÈ´ý×ª»»³É¹¦£¬¶øÈç¹ûÄãÊÇÒ»Ö±Ë¢×ÅµÄ»°£¬¾Í²»ÓÃÕâ¸öÑÓÊ±ÁË
 113   1         
 114   1      }
 115          /*******************************************************************************
 116          * º¯ÊýÃû         : Ds18b20ReadTempCom
C51 COMPILER V9.01   TEMP                                                                  07/03/2018 16:49:55 PAGE 3   

 117          * º¯Êý¹¦ÄÜ                 : ·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 118          * ÊäÈë           : com
 119          * Êä³ö           : ÎÞ
 120          *******************************************************************************/
 121          
 122          void  Ds18b20ReadTempCom()
 123          {       
 124   1      
 125   1              Ds18b20Init();
 126   1              Delay1ms(1);
 127   1              Ds18b20WriteByte(0xcc);  //Ìø¹ýROM²Ù×÷ÃüÁî
 128   1              Ds18b20WriteByte(0xbe);  //·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 129   1      }
 130          
 131          /*******************************************************************************
 132          * º¯ÊýÃû         : Ds18b20ReadTemp
 133          * º¯Êý¹¦ÄÜ                 : ¶ÁÈ¡ÎÂ¶È²¢ÔÚÖ÷º¯ÊýÀïÃæÏÔÊ¾ÎÂ¶È
 134          * ÊäÈë           : com
 135          * Êä³ö           : ÎÞ
 136          *******************************************************************************/
 137          void Ds18b20ReadTemp()
 138          {
 139   1              int temp=0;
 140   1              float tp;
 141   1              unsigned char tmh,tml;
 142   1      
 143   1              Ds18b20ChangTemp();                             //ÏÈÐ´Èë×ª»»ÃüÁî
 144   1              Ds18b20ReadTempCom();                   //È»ºóµÈ´ý×ª»»Íêºó·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 145   1              tml=Ds18b20ReadByte();          //¶ÁÈ¡ÎÂ¶ÈÖµ¹²16Î»£¬ÏÈ¶ÁµÍ×Ö½Ú
 146   1              tmh=Ds18b20ReadByte();          //ÔÙ¶Á¸ß×Ö½Ú
 147   1              temp=tmh;
 148   1              temp<<=8;
 149   1              temp|=tml;
 150   1      
 151   1              if(temp < 0)                            //µ±ÎÂ¶ÈÖµÎª¸ºÊý
 152   1              {
 153   2                      show_char(80+5,16,'-');
 154   2              
 155   2                      temp=temp-1;    //ÒòÎª¶ÁÈ¡µÄÎÂ¶ÈÊÇÊµ¼ÊÎÂ¶ÈµÄ²¹Âë£¬ËùÒÔ¼õ1£¬ÔÙÈ¡·´Çó³öÔ­Âë
 156   2                      temp=~temp;
 157   2                      tp=temp;
 158   2                      temp=tp*0.0625*100+0.5;
 159   2                      //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
 160   2                      //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
 161   2                      //ËãÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡
 162   2              }
 163   1              else
 164   1              {                       
 165   2                      show_char(80+5,16,'+');
 166   2                      tp=temp;//ÒòÎªÊý¾Ý´¦ÀíÓÐÐ¡ÊýµãËùÒÔ½«ÎÂ¶È¸³¸øÒ»¸ö¸¡µãÐÍ±äÁ¿
 167   2                              //Èç¹ûÎÂ¶ÈÊÇÕýµÄ,ÄÇÃ´ÕýÊýµÄÔ­Âë¾ÍÊÇ²¹ÂëËü±¾Éí
 168   2                      temp=tp*0.0625*100+0.5; 
 169   2                      //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
 170   2                      //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
 171   2                      //Ëã¼ÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
 172   2              }
 173   1      
 174   1                      TEMP.shi_wei = temp % 10000 / 1000;
 175   1                      TEMP.ge_wei =  temp % 1000 / 100;
 176   1                      TEMP.dian_yi = temp % 100 / 10;
 177   1                      TEMP.dian_er = temp % 10;
 178   1      
C51 COMPILER V9.01   TEMP                                                                  07/03/2018 16:49:55 PAGE 4   

 179   1                      //ÎÂ¶ÈÏÔÊ¾Çø
 180   1                      show_number(88+5,16,TEMP.shi_wei,1);
 181   1                      show_number(96+5,16,TEMP.ge_wei,1);
 182   1                      show_char(104+5,16,'.');
 183   1                      show_number(112+5,16,TEMP.dian_yi,1);
 184   1                      show_number(120+5,16,TEMP.dian_er,1);
 185   1                      show_char(128+5,16,'C');  //ÎÂ¶Èµ¥Î»ÔõÃ´ÏÔÊ¾?
 186   1      }
 187          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    555    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
