C51 COMPILER V9.01   SR04                                                                  07/03/2018 19:55:34 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE SR04
OBJECT MODULE PLACED IN SR04.obj
COMPILER INVOKED BY: D:\keilC51\C51\BIN\C51.EXE USERS\SR04.c BROWSE DEBUG OBJECTEXTEND PRINT(.\SR04.lst) OBJECT(SR04.obj
                    -)

line level    source

   1          
   2          //==================
   3          //SR04.c
   4          //==================
   5          //Ò»¸ö°²È«ÓÅÐãµÄ³ÌÐò£¬±ØÈ»°üº¬ÁËËùÓÐµÄ¿ÉÄÜÇé¿ö£¬µ«ÊÇÕâÑùµÄ»°ÊÆ±ØÔö´ó³ÌÐòÌå»ý£¬ÓÅ»¯ºÜÖØÒª£¡
   6          
   7          #include "main.h"
   8          
   9          #define NUM 3                   //ÂË²¨´ÎÊý
  10          
  11          uchar time0_flag = 0;   //¶¨Ê±Æ÷Òç³ö±êÖ¾
  12          
  13          /*³õÊ¼»¯º¯Êý
  14           ¶¨Ê±Æ÷Ä£Ê½1£¬´Ó0¿ªÊ¼¼ÆÊý£¬×î´óµ½65535£¬Ò»´ÎÒç³öÐèÒªµÄÊ±¼äÊÇ0.065s£¬ÉùËÙÎª340m/s
  15           ÄÇÃ´Òç³öÊ±µÄ¾àÀëÎª22.1m£¬ÒÑ¾­Ô¶Ô¶³¬¹ýÁË³¬Éù²¨Ä£¿éµÄ²âÁ¿·¶Î§(0-5m),ËùÒÔÖ»Òª²úÉúÒ»´ÎÒç³ö£¬¾Í¿ÉÒÔÈÏÎªÊÇ³¬³ö²
             -âÁ¿·¶Î§. 
  16          */
  17          void sr04_init()
  18          {       
  19   1              TRIG = 0;
  20   1              ECHO = 0;
  21   1      
  22   1              TMOD |= 0X01;   //¶¨Ê±Æ÷0Ä£Ê½ÉèÖÃ1
  23   1              TH0 = 0;                //´Ó0¿ªÊ¼¼ÆÊý
  24   1              TL0 = 0;
  25   1              TR0 = 0;                //¹Ø±Õ¶¨Ê±Æ÷
  26   1              EA = 1;                 //¿ª×ÜÖÐ¶Ï
  27   1              ET0 = 1;                //ÔÊÐí¶¨Ê±Æ÷0ÖÐ¶Ï
  28   1      }
  29          
  30          /*start*/
  31          void  sr04_start()
  32          {
  33   1               TRIG = 1;      
  34   1               delay_10us(5); //À­¸ß50us
  35   1               TRIG = 0;
  36   1      }
  37          
  38          /*¿ªÆô¶¨Ê±Æ÷0£¬´ò¿ªÖ®Ç°ÏÈÇå³ýÖ®Ç°µÄ¼ÆÊý,²»È»»áÀÛ¼Æ¼ÆÊý*/
  39          void time_0_start()
  40          {       
  41   1              TH0 = 0;           //´ò¿ªÇ°¼ÆÊýÇåÁã
  42   1              TL0 = 0;
  43   1              TR0 = 1;           //´ò¿ª¶¨Ê±Æ÷
  44   1      }
  45          
  46          /*********************************
  47          ×÷Õß £ºAndre
  48          ÈÕÆÚ £º2018.3.8
  49          ËµÃ÷ £º
  50                  1¡¢¿ªÆô³¬Éù²¨²â¾à£¬¶à´Î²âÁ¿È¡Æ½¾ùÖµ£¬µ±³¬³ö²âÁ¿·¶Î§Ê±£¬ÉáÈ¥
  51          **********************************/
  52          float get_distence()
  53          {
C51 COMPILER V9.01   SR04                                                                  07/03/2018 19:55:34 PAGE 2   

  54   1              unsigned long int time_buf = 0;         //×ÜºÄÊ±
  55   1              float distence = 0;             //¼ÆËãÒ»´Î¾àÀë
  56   1              float sum = 0;              //¶à´Î¼ÆËãµÄ×Ü¾àÀë
  57   1              uchar i = 0;
  58   1      
  59   1              while(i < NUM)
  60   1              {
  61   2                      time0_flag = 0; //ÏÈÇå³ý±êÖ¾
  62   2                      sr04_start();   //¿ªÊ¼²â¾à
  63   2                      while(!ECHO);   //µÈ´ý·¢³ö40khzÂö³å£¬´¥·¢ÐÅºÅÖ®ºó£¬echo»á±ä³É¸ßµçÆ½
  64   2                      time_0_start(); //µ±°ÑtrigÀ­¸ß10usÖ®ºó£¬Ä£¿é¼´¿ªÊ¼·¢³ö8¸ö40khzµÄÂö³å£¬Óë´ËÍ¬Ê±£¬echo±äÎª¸ßµçÆ½Ê±£¬´ò¿ª¶¨
             -Ê±Æ÷¡£
  65   2                      while(ECHO);    //µÈ´ý»ØÏìÐÅºÅ£¬ÊÕµ½»ØÏìÐÅºÅ£¬echo»á±äµÍµçÆ½
  66   2                      TR0 = 0;                //¹Ø±Õ¶¨Ê±Æ÷
  67   2      
  68   2                      if(time0_flag != 0)  //³¬³ö²âÁ¿·¶Î§
  69   2                              continue;               //²»½øÐÐ¼ÆËã£¬·ÅÆúÕâ´Î²âÁ¿£¬´ÓÐÂ²âÁ¿
  70   2      
  71   2                      else                            //time_flag = 0,Ã»ÓÐ³¬³ö²âÁ¿·¶Î§
  72   2                      {
  73   3                              time_buf = (TH0 * 256) + TL0;
  74   3                              distence = time_buf * 0.0168;//£¨µ¥Î»:cm£©ËäÈ»ÉùËÙ340m/s£¬·¢ÏÖÊ¹ÓÃ0.0168¸ü¾«È·£¬¿ÉÄÜºÍÎÂ¶ÈÓÐ¹Ø
  75   3                              sum+= distence;
  76   3                              i++;
  77   3                      }         
  78   2              }       
  79   1              return (sum/NUM) ;      //È¡NUM´ÎÆ½¾ùÖµ
  80   1      }
  81          
  82          /*
  83          ÖÐ¶Ï´¦Àíº¯Êý£¬65535¸ö¼ÆÊý²úÉúÒç³ö£¬´ó¸ÅÎª71.1ms
  84          Èç¹û²úÉúÒç³ö£¬ËµÃ÷¾àÀëÒÑ¾­³¬¹ýÁË22.1Ã×
  85          ÒÑ¾­Ô¶Ô¶³¬¹ýÁËÄ£¿éµÄ²âÁ¿·¶Î§
  86          */
  87          void TIME0() interrupt 1
  88          {
  89   1      //      TF0 = 0;           //Ä£Ê½1Ó²¼þ×Ô¶¯ÇåÁã
  90   1              TH0 = 0;
  91   1              TL0 = 0;
  92   1              time0_flag++;
  93   1      }
  94          
  95          //========================
  96          //END OF FILE
  97          //========================
  98          
  99          
 100          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    204    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
